<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Milk Factory :: Partner</title>
    <script src="./common.js"></script>
    <link href="./styles.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.20/lodash.min.js"></script>

    <script src="https://unpkg.com/vue@3.0.2/dist/vue.global.js"></script>

    <link href="https://unpkg.com/primevue@3.0.1/resources/themes/saga-blue/theme.css" rel="stylesheet">
    <link href="https://unpkg.com/primevue@3.0.1/resources/primevue.min.css" rel="stylesheet">
    <link href="https://unpkg.com/primeicons@4.1.0/primeicons.css" rel="stylesheet">
    <script src="https://unpkg.com/primevue@3.0.1/components/calendar/calendar.umd.min.js"></script>
    <script src="https://unpkg.com/primevue@3.0.1/components/dropdown/dropdown.umd.min.js"></script>
</head>
<body style="background-image: url(https://hips.hearstapps.com/del.h-cdn.co/assets/15/24/1600x800/landscape-1433889344-del-milkshakes-index.jpg); background-color: rgba(255, 255, 255, 0.85); background-blend-mode: overlay;">
    <h2>The Milk Factory :: Partner</h2>
    <div id="app">
        <div style="width: 100%; text-align: right; font-size: small;">
            <button onclick="window.location.href='./sales.html'">sales</button>
            <button onclick="pingAll()">reload all microservices</button>
        </div>
        <div>
            Partner ID: {{id}}<br>
            First Name: {{model.partner.firstName}}<br>
            Last Name: {{model.partner.lastName}}<br>
            DoB: {{model.partner.dob}}<br>
            Email: {{model.partner.email}}<br>
            Phone: {{model.partner.phone}}<br>
            Type: {{model.partner.type}}<br>
        </div>
    </div>
    <hr>
</body>
<script>
var urlParams = new URLSearchParams(window.location.search);
var id = urlParams.get('id');
console.log(id);

const App = {
  data() {
    return {
      model: { "id": id, "partner": {} },
      start: 0,
      timeTaken: 0,
      requestId: uuidv4()
    }
  },
  mounted() {
    this.fetchPartner(this.id);
    window.model = this.model; // just for debugging purposes
  },
  methods: {
    fetchPartner() {
        let self = this;
        let url = PARTNERS_BASE_URL + "/partners/" + this.model.id;
        fetchIt(url, "GET", this).then(r => {
            if(r.ok) {
                console.log("got partner with id " + r.id + ", for requestId " + this.requestId);
                self.model.partner = r.payload;
            } else {
                let msg = "Failed to get partner: " + r.payload.error;
                console.error(msg);
                alert(msg);
            }
        }).catch(error => {
            alert("received error: " + error);
        });
    }
  },
  components: {
  }
}
Vue.createApp(App).mount("#app")

</script>
</html>
